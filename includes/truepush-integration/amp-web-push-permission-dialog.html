<!doctype html>
<html>
<!-- AMP Web Push Permission Dialog -->

<head>
	<meta charset="utf-8">

	<!-- Do not edit styles in this section -->
	<style builtin>
		/* Do not edit styles in this section. Add custom styles in the next
       style section */
		html,
		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		/* Default loading spinner */
		.spinner,
		.spinner:after {
			border-radius: 50%;
			width: 10em;
			height: 10em;
		}

		.spinner {
			margin: 60px auto;
			font-size: 10px;
			position: relative;
			text-indent: -9999em;
			border-top: 1.1em solid rgba(140, 140, 140, 0.2);
			border-right: 1.1em solid rgba(140, 140, 140, 0.2);
			border-bottom: 1.1em solid rgba(140, 140, 140, 0.2);
			border-left: 1.1em solid rgb(140, 140, 140);
			-webkit-transform: translateZ(0);
			-ms-transform: translateZ(0);
			transform: translateZ(0);
			-webkit-animation: spinner 1.1s infinite linear;
			animation: spinner 1.1s infinite linear;
		}

		@-webkit-keyframes spinner {
			0% {
				-webkit-transform: rotate(0deg);
				transform: rotate(0deg);
			}

			100% {
				-webkit-transform: rotate(360deg);
				transform: rotate(360deg);
			}
		}

		@keyframes spinner {
			0% {
				-webkit-transform: rotate(0deg);
				transform: rotate(0deg);
			}

			100% {
				-webkit-transform: rotate(360deg);
				transform: rotate(360deg);
			}
		}

		/* Horizontally and vertically center items */
		body {
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 15px;
		}

		/* Page message text styles */
		.message {
			font-size: 22px;
			font-family: sans-serif;
			text-align: center;
		}

		/* Close icon styles */
		#close {
			position: fixed;
			right: 32px;
			top: 32px;
			width: 32px;
			height: 32px;
			opacity: 0.5;
			cursor: pointer;
		}

		#close:before,
		#close:after {
			position: fixed;
			right: 48px;
			content: ' ';
			height: 33px;
			width: 3px;
			background-color: #333;
		}

		#close:before {
			transform: rotate(45deg);
		}

		#close:after {
			transform: rotate(-45deg);
		}

		/* Used to hide the preload and postload sections */
		.invisible {
			display: none;
		}

		#denied {
			display: none;
		}
	</style>

	<!-- Optional: Add custom styles here -->
	<style amp-custom>
		html,
		body {
			margin: 0;
			padding: 0;
			background-color: #f6f6f6;
			width: 100%;
			height: 100%;
			overflow: hidden;
			font-size: 14px;
			font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
			background: #f1f1f1
		}

		.wrapper {
			width: 100%;
			height: 100%;
			box-sizing: border-box;
			padding: 2em;
			display: -ms-flexbox;
			display: flex;
			-ms-flex-direction: row;
			flex-direction: row;
			-ms-flex-align: center;
			align-items: center;
			-ms-flex-pack: center;
			justify-content: center;
			text-align: center;
		}

		.title {
			font-size: 1.429em;
			font-weight: 500;
			max-width: 360px;
			margin: 0 auto;
		}

		.subtitle {
			font-size: 1.143em;
			font-weight: 300;
			line-height: 1.714em;
			color: #666;
			margin: .714em auto 2.143em;
			max-width: 360px;
		}

		.notice {
			font-style: italic;
			font-weight: 300;
			color: #999;
			font-size: 12px;
			text-align: center;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			text-align: center;
		}

		#subsus {
			margin-top: 20px;
			display: none;
			color: green
		}

		button {
			margin: 25px auto;
			display: block;
			background: #2c7be5;
			border: none;
			color: #fff;
			font-size: 22px;
			padding: 10px 35px;
			line-height: 1;
			border-radius: 5px;
			cursor: pointer;
			display: none;
		}

		button:hover {
			background: #1a68d1;
		}

		.logo {
			text-align: center;
			display: none;
		}

		.logo img {
			width: 100px;
		}

		#subsus p {
			font-size: 20px;
			margin: 10px;
			color: #616161
		}
	</style>
</head>

<body>
	<div class="wrapper">
		<div class="content">
			<div id="before-permission">
        <div class="title" id="allow">Click Allow</div>
        <div class="subtitle">We'd like to send you notifications for the latest news and updates.<button
					id="proceed-button" onclick="ProceedForFirefox()">Click to proceed &#187;</button></div>
				<div class="logo"></div>
				<div class="unsubscribe notice">You can unsubscribe anytime</div>
			</div>
			<div id="subsus" style="">
				<svg style="width: 100px; margin-bottom: 30px;" version="1.1" id="Layer_1"
					xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
					viewBox="0 0 286.054 286.054" style="enable-background:new 0 0 286.054 286.054;"
					xml:space="preserve">
					<g>
						<path style="fill:#3DB39E;"
							d="M143.031,0C64.027,0,0.004,64.04,0.004,143.027c0,78.996,64.031,143.027,143.027,143.027
								c78.987,0,143.018-64.031,143.018-143.027C286.049,64.049,222.018,0,143.031,0z M143.031,259.236
								c-64.183,0-116.209-52.026-116.209-116.209S78.857,26.818,143.031,26.818s116.2,52.026,116.2,116.209
								S207.206,259.236,143.031,259.236z M199.241,82.187c-6.079-3.629-13.847-1.475-17.342,4.827l-47.959,86.147l-26.71-32.512
								c-4.836-5.569-11.263-8.456-17.333-4.827c-6.079,3.638-8.591,12.39-4.657,18.004l37.169,45.241c2.78,3.611,5.953,5.775,9.27,6.392
								l0.027,0.054l0.34,0.018c0.751,0.116,11.979,2.19,16.815-6.463l55.048-98.876C207.402,93.879,205.32,85.825,199.241,82.187z" />
					</g>
				</svg>
				<p>Thank you for your subscription.</p>
				<p>This window will now close automatically.</p>
			</div>
			<div id="denied">
				Please unblock notifications in your browser settings to receive notifications from this website.
			</div>
		</div>
	</div>

<!-- We are not using live script  <script src="https://sdki.truepush.com/sdk/v2.0.3/amp-permission-dialog.js"></script>
	 since that fetchs sw.js from root on most wordpress setups which breaks the functionality
     Issue lies in the fact that non-existant media file are redirected to homepage with 200 status   -->	
  <script>var t,applicationServerKey,userConsent,userPlatformId,tp_sw_path,subscription,host="https://sdk.truepush.com/";let d={},msgChannel=new MessageChannel;function send(e){let s={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:"topic-notification-permission-state",data:e};d.port1.postMessage(s).then(function(e){console.log(e)})}function UrlExists(e){console.log("Url : ",e);var s=new XMLHttpRequest;try{s.open("HEAD",e,!1),s.send()}catch(r){}return s.status}function connect(){return new Promise(function(e,s){d.port1.start(),d.port1.addEventListener("message",function(e){console.log("got an Event",d.port1)}),d.port2.addEventListener("message",function(e){console.log("event called",event)}),console.log("conneted"),opener.postMessage({topic:"topic-connect-handshake"},"*",[msgChannel.port2]),e()})}d.port1=msgChannel.port1,d.port2=msgChannel.port2,t=this,t.HTTP=new function(){this.post=function(e,s,r,n){var o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");o.onreadystatechange=function(){if(4==this.readyState){if(200!=this.status)return n("error",null);try{return n(null,JSON.parse(o.responseText))}catch(e){return n(null,o.responseText)}}},o.open("POST",e,!0),r&&r.headers&&(o=function(e,s){for(var r=Object.keys(s),n=0;n<r.length;++n){var o=r[n];e.setRequestHeader(o,s[o])}return e}(o,r.headers)),r&&r.credentials&&(o.withCredentials=!0),o.send(JSON.stringify(s))}};var user_browser=navigator.userAgent.indexOf("Firefox")>-1?"Firefox":"safari"in window?"Safari":"Chrome",d1=new Date;today=d1.getMonth()+1+"/"+d1.getDate()+"/"+d1.getFullYear()+" 00:00";var _wp_is_safari=!1,_wp_debug=!0;let reg;document.getElementById("allow").style.display="none";const queryString=window.location.search,urlParams=new URLSearchParams(queryString);applicationServerKey=urlParams.get("publicKey"),console.log(applicationServerKey),userConsent=urlParams.get("userConsent");var checkUrl=UrlExists(window.location.origin+"/sw.js");checkUrl=!1,console.log("urlCheck : ",checkUrl);var publicMethods={init:function(){if(console.log("AMP Web Push Notifications powered by TRUEPUSH"),navigator.serviceWorker){var e="";e=200==checkUrl?"sw.js":"wp-content/plugins/truepush-free-web-push-notifications/sw2.php",navigator.serviceWorker.register(e),navigator.serviceWorker.ready.then(e=>{reg=e,e.active.postMessage({key:applicationServerKey})})}if(userConsent&&!["allowed_cookies_only","denied","allowed_cookies_personal_data"].includes(userConsent))return;if(userConsent&&"denied"===userConsent)return void console.error("permission denied");let s=localStorage.getItem("platformDetails");switch(s=JSON.parse(s),tp_sw_path=200==checkUrl?"/sw.js":"/wp-content/plugins/truepush-free-web-push-notifications/sw2.php",_TPBrowserSupport()){case!0:_tp_registerServiceWorker();break;case"denied":case"http":_truepushCheckPermission();break;case"Firefox":navigator.userAgent.toLowerCase().indexOf("mobile")>-1?_tp_registerServiceWorker():document.getElementById("proceed-button").style.display="block"}}};function ProceedForFirefox(){document.getElementById("before-permission").style.display="none",document.getElementById("proceed-button").style.display="none",_tp_registerServiceWorker()}function _TPBrowserSupport(){return"safari"in window&&"pushNotification"in window.safari?"safari":"serviceWorker"in navigator?"PushManager"in window?"showNotification"in ServiceWorkerRegistration.prototype?"denied"===Notification.permission?(console.log("TRUEPUSH: Notifications are denied by the user "),"denied"):!(navigator.userAgent.indexOf("Firefox")>-1)||"Firefox":(console.warn("TRUEPUSH: Notifications are not supported by this browser"),!1):(console.warn("TRUEPUSH: Push notifications are not supported by this browser"),!1):(console.warn("TRUEPUSH: Service workers are not supported by this browser"),!1)}function _tp_registerServiceWorker(){navigator.serviceWorker.register(tp_sw_path,{scope:"/"}).then(function(e){console.log("Service worker has been registered successfully!"),_truepushCheckPermission()},e=>{console.error("[SW] Service worker registration failed",e),console.warn("Cannot access service worker file. Please confirm you have service worker file at  "+tp_sw_path)})}function _truepushCheckPermission(){"denied"==Notification.permission?(document.getElementById("subsus").style.display="none",document.getElementById("before-permission").style.display="none",document.getElementById("denied").style.display="block",console.log("Checking permission"),connect().then(function(){send("denied")}),setTimeout(function(){window.close()},1e3)):"default"==Notification.permission?(document.getElementById("allow").style.display="block",document.getElementById("before-permission").style.display="block",_tpRequestPermission()):"granted"==Notification.permission&&CheckSubscription()}function CheckSubscription(){localStorage.getItem("subscription")?console.log("User alerady subscribed"):navigator.serviceWorker.ready.then(e=>e.pushManager.getSubscription()).then(e=>e?_tpSendSubscriptionToServer(e):(console.log("No subscription found, ask for permission"),void _tpRequestPermission())).catch(e=>{console.log(e)})}function _tpRequestPermission(){platformDetails=localStorage.getItem("platformDetails"),Notification.requestPermission().then(e=>{switch(localStorage.setItem("permission",e),localStorage.setItem("amp-web-push-notification-permission",Notification.permission),e){case"default":SaveRequest({ignore:!0,optinType:platformDetails.optInType},"ignore"),document.getElementById("subsus").style.display="none",document.getElementById("before-permission").style.display="none",SendUpdateVisitRequest();break;case"denied":SaveRequest({block:!0,optinType:platformDetails.optInType},"block"),connect().then(function(){send("denied")}).catch(function(){}),document.getElementById("subsus").style.display="none",document.getElementById("before-permission").style.display="none",document.getElementById("denied").style.display="block",SendUpdateVisitRequest();break;case"granted":_truepushSubscribeNow()}})}function _truepushSubscribeNow(e=null){navigator.serviceWorker.ready.then(function(s){s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_tp_urlBase64ToUint8Array(applicationServerKey)}).then(e=>e?(subscription=_tpCheckKeys(e),console.log("New subscriber added"),_tpSendSubscriptionToServer(subscription)):(console.error("subscription not found",e),void setTimeout(function(){window.close()},300))).catch(s=>{console.log(s),null!==e&&e.unsubscribe().then(function(e){_tpRequestPermission()})})})}function _tp_urlBase64ToUint8Array(e){let s=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(s),n=new Uint8Array(r.length);for(let o=0;o<r.length;++o)n[o]=r.charCodeAt(o);return n}function _tpCheckKeys(e){var s=JSON.parse(JSON.stringify(e)),r={};return s.keys||(s.keys={auth:ConvertToB64SafeUrl(btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("auth"))))),p256dh:ConvertToB64SafeUrl(btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("p256dh")))))}),s&&(r.endpoint=s.endpoint,r.keys={},r.keys.p256dh=s.keys.p256dh,r.keys.auth=s.keys.auth),r}function _tpSendSubscriptionToServer(e){try{var s={};let r=localStorage.getItem("platformDetails");if(document.getElementById("subsus").style.display="block",document.getElementById("before-permission").style.display="none",r=JSON.parse(r)){s={subscription:e,isChrome:isChrome()},localStorage.setItem("subscription",JSON.stringify(e)),userConsent&&"allowed_cookies_only"===userConsent&&(s.deniedPersonalData=!0,delete s.language),(navigator.language||navigator.userLanguage&&userConsent&&"allowed_cookies_personal_data"===userConsent)&&(s.language=navigator.language||navigator.userLanguage),localStorage.getItem("tp-uniqueShow")||localStorage.setItem("tp-uniqueShow",!0),s.userPlatformId=r._id,s.optinType="default";var n=localStorage.getItem("tp-visitsData");if(n)try{n=JSON.parse(n),s.visitsData=PrepareRequestData(n)}catch(o){console.error(o)}HTTP.post(host+"api/v1/upsertSubscriber",s,{credentials:!0,headers:{"Content-Type":"application/json"}},function(e,s){e?console.error(e):s&&s.data&&"string"==typeof s.data?localStorage.setItem("subscriberId",s.data):console.log("no subscription found",s),connect().then(function(){send("granted")}).catch(function(){}),setTimeout(function(){window.close()},1500)})}else console.log("you need to reload your browser and try to subscribe agian"),setTimeout(function(){window.close()},500)}catch(i){console.error(i)}}function isChrome(){if(navigator&&navigator.plugins){for(var e=0;e<navigator.plugins.length;e++)if("Chrome PDF Viewer"==navigator.plugins[e].name)return!0}return!1}function _tp_SaveRequestsToLocalStorage(e,s){var r=localStorage.getItem("tp-visitsData");try{if((r=r?JSON.parse(r):{})[s]){var n=r[s].count?r[s].count:0;try{r[s]=e,r[s].count=++n}catch(o){console.log("visitData error")}}else r[s]=e,r[s].count=1;localStorage.setItem("tp-visitsData",JSON.stringify(r))}catch(i){}}function PrepareRequestData(e){for(var s=[],r=Object.keys(e),n=0;n<r.length;n++)e[r[n]].keyType=r[n],s.push(e[r[n]]);return s}function SaveRequest(e,s){if(platformDetails.browserData&&platformDetails.browserData.browser&&"Safari"===platformDetails.browserData.browser.name){var r=window.safari.pushNotification.permission(platformDetails.safariDetails.webPushId);r&&"granted"===r.permission&&r.deviceToken&&(e.deviceToken=r.deviceToken)}localStorage.getItem("tp-uniqueShow")||(localStorage.setItem("tp-uniqueShow",!0),SaveRequest({uniqueShow:!0},"uniqueShow")),(navigator.language||navigator.userLanguage&&userConsent&&"allowed_cookies_personal_data"===userConsent)&&(e.language=navigator.language||navigator.userLanguage),userConsent&&"allowed_cookies_only"===userConsent&&(e.deniedPersonalData=!0),_tp_SaveRequestsToLocalStorage(e,s,function(e,s){})}function SendUpdateVisitRequest(e,s){if(!(s>=2)){var r=localStorage.getItem("tp-visitsData");if(r||e)try{var n=[];e?n=e:(r=JSON.parse(r),n=PrepareRequestData(r));var o={visitsData:n,platformId:platformDetails._id};userConsent&&"allowed_cookies_only"===userConsent&&(o.deniedPersonalData=!0),HTTP.post(host+"api/v1/updateVisit",o,{credentials:!0,headers:{"Content-Type":"application/json"}},function(e,r){if(e)return s||(s=0),SendRequest(n,++s);localStorage.removeItem("tp-visitsData"),setTimeout(function(){window.close()},1500),e?console.log("error occured ",e):r&&"ERROR"==r.status&&console.log("error occured ",r)})}catch(i){console.log("updatevisit error",i)}}}localStorage.getItem("platformDetails")?publicMethods.init():console.log("platform is not found");</script>

</body>

</html>

